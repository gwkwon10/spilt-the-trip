<!--Main page with all the trips for the user-->
<%= stylesheet_link_tag "https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css", media: "all", "data-turbo-track": "reload" %>

<div class="container py-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h2 fw-bold text-primary">Your Trips</h1>
    <%= link_to "New Trip", new_trip_path, class: "btn btn-primary btn-lg" %>
  </div>

  <% if @trips.any? %>
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
      <% @trips.each do |trip| %>
        <div class="col">
          <div class="card h-100 shadow-sm border-primary border-2">
            <div class="card-header bg-primary text-white">
              <h5 class="card-title mb-0"><%= trip.name %></h5>
              <small>
                <%= trip.start_date.strftime("%b %d") %> - <%= trip.end_date.strftime("%b %d, %Y") %>
              </small>
            </div>

            <div class="card-body">
              <div class="mb-3">
                <span class="badge bg-info text-dark me-2">
                  <%= pluralize(trip.participants.count, "participant") %>
                </span>
                <span class="badge bg-success-subtle text-success">
                  <%= trip.expenses.count.zero? ? "No expenses" : "#{trip.expenses.count} expenses" %>
                </span>
              </div>

              <% if trip.expenses.any? %>
                <p class="fw-semibold text-muted">
                  Total: <%= number_to_currency(trip.expenses.sum(:amount)) %>
                </p>
              <% end %>

              <% if trip.participants.any? %>
                <div class="d-flex align-items-center gap-1 mb-3">
                  <% trip.participants.first(5).each do |participant| %>
                    <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center border border-white"
                      style="width: 32px; height: 32px; font-size: 14px;">
                      <%= participant.name[0].upcase %>
                    </div>
                  <% end %>
                  <% if trip.participants.count > 5 %>
                    <div class="rounded-circle bg-light text-dark d-flex align-items-center justify-content-center border border-secondary"
                      style="width: 32px; height: 32px; font-size: 14px;">
                      +<%= trip.participants.count - 5 %>
                    </div>
                  <% end %>
                </div>
              <% end %>

              <div class="d-flex justify-content-between align-items-center">
                <%= link_to "View Details", trip_path(trip), class: "btn btn-outline-primary btn-sm" %>
                <small class="text-muted">
                  <% if trip.created_at > 24.hours.ago %>
                    Created <%= time_ago_in_words(trip.created_at) %> ago
                  <% else %>
                    Created on <%= trip.created_at.strftime("%b %d, %Y") %>
                  <% end %>
                </small>
              </div>
            </div> 
          </div> 
        </div> 
      <% end %>
    </div> 
  <% end %>
</div> 
